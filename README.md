# GQT-Lambda-Function
An AWS Lambda function for executing serverless GQT queries through a REST API

### Overview
Genetic Query Tools ([GQT](https://github.com/ryanlayer/gqt "GQT")) is command-line software that can be used to query large-scale genotype data. This repository contains the scripts for deploying a serverless version of that software that can be accesssed with a REST API. The function named 'gqt' is a Lambda function to be accessed by an API and can respond to a user with the URL of the GQT query. This URL can be accessed on a command line with curl, wget, etc. or entered in a browser search bar to download the results. The Lambda function named 'gqt_helper' executes the actual query. 'gqt' calls 'gqt_helper' and quickly responds to the API with the URL of the S3 object that 'gqt_helper' will generate once it has finished querying. This way, 'gqt' quickly responds to the user and avoids the 29 second time limit for API responses while 'gqt_helper' does the actual query in the background over the course of a couple minutes. 'GQT-Layer.zip' is an AWS Lambda layer that contains the GQT software, and 'AWSCLI-Layer.zip' is an AWS Lambda layer that contains the 'AWSCLI' package. AWSCLI is used by 'gqt_helper' to pipe the output of GQT directly to S3 to save memory for the Lambda function.

### Usage
This simply contains the code for this project, it is not designed to work in its current state. The Lambda layers can be downloaded if you want to adjust them, but public, working versions of them are published and can be attached to any AWS Lambda function. The arn for the GQT layer is: arn:aws:lambda:us-east-1:783027271111:layer:gqt:2 and the arn for the AWSCLI layer is: arn:aws:lambda:us-east-1:783027271111:layer:awscli:1. To get the rest working, you can copy and paste the code from the two Lambda functions into blank Python2.7 Lambda functions, or pull them from here and deploy them with AWS CLI. Then, attach the two Lambda layers to 'gqt_helper' using the arns above. A REST API can be created for 'gqt' in API Gateway. Create the REST API, then create a 'GET' method for it and enter 'gqt' as the Lambda function. Then, under 'Integration Request', go to 'Mapping Templates' and add a mapping template of type 'application/json'. This is the code I applied to that to allow the API to accept the correct parameters:

